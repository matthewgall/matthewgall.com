{{ if .Site.Params.social_sharing }}
<section class="social-share" role="complementary" aria-label="Share this post">
  <h4 class="social-share-title">ðŸ’¬ Share this post</h4>

  <div class="social-share-buttons">
    <!-- X (Twitter) -->
    <a href="#"
       target="_blank"
       rel="noopener noreferrer"
       class="share-button twitter"
       data-share-type="twitter"
       data-title="{{ .Title }}"
       data-path="{{ .RelPermalink }}"
       {{ with .Site.Params.twitter.site }}data-via="{{ . }}"{{ end }}
       aria-label="Share on X (Twitter)">
      {{ partial "social-icon.html" "twitter" }}
      <span>{{ partial "social-display-name.html" "twitter" }}</span>
    </a>

    <!-- LinkedIn -->
    <a href="#"
       target="_blank"
       rel="noopener noreferrer"
       class="share-button linkedin"
       data-share-type="linkedin"
       data-title="{{ .Title }}"
       data-path="{{ .RelPermalink }}"
       aria-label="Share on LinkedIn">
      {{ partial "social-icon.html" "linkedin" }}
      <span>{{ partial "social-display-name.html" "linkedin" }}</span>
    </a>

    <!-- Bluesky -->
    <a href="#"
       target="_blank"
       rel="noopener noreferrer"
       class="share-button bluesky"
       data-share-type="bluesky"
       data-title="{{ .Title }}"
       data-path="{{ .RelPermalink }}"
       aria-label="Share on Bluesky">
      {{ partial "social-icon.html" "bluesky" }}
      <span>{{ partial "social-display-name.html" "bluesky" }}</span>
    </a>

    <!-- Threads -->
    <a href="#"
       target="_blank"
       rel="noopener noreferrer"
       class="share-button threads"
       data-share-type="threads"
       data-title="{{ .Title }}"
       data-path="{{ .RelPermalink }}"
       aria-label="Share on Threads">
      {{ partial "social-icon.html" "threads" }}
      <span>{{ partial "social-display-name.html" "threads" }}</span>
    </a>

    <!-- Mastodon -->
    <a href="#"
       target="_blank"
       rel="noopener noreferrer"
       class="share-button mastodon"
       data-share-type="mastodon"
       data-title="{{ .Title }}"
       data-path="{{ .RelPermalink }}"
       aria-label="Share on Mastodon">
      {{ partial "social-icon.html" "mastodon" }}
      <span>{{ partial "social-display-name.html" "mastodon" }}</span>
    </a>

    <!-- Copy Link -->
    <button class="share-button copy-link"
            data-path="{{ .RelPermalink }}"
            aria-label="Copy link to clipboard">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
      </svg>
      <span>Copy Link</span>
    </button>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get the current absolute URL based on the actual domain being used
  function getAbsoluteUrl(path) {
    return window.location.origin + path;
  }

  // Initialize share buttons with dynamic URLs
  const shareButtons = document.querySelectorAll('[data-share-type]');
  shareButtons.forEach(button => {
    const shareType = button.dataset.shareType;
    const title = button.dataset.title;
    const path = button.dataset.path;
    const absoluteUrl = getAbsoluteUrl(path);
    const encodedUrl = encodeURIComponent(absoluteUrl);
    const encodedTitle = encodeURIComponent(title);

    let shareUrl = '';

    switch(shareType) {
      case 'twitter':
        const via = button.dataset.via ? `&via=${button.dataset.via}` : '';
        shareUrl = `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}${via}`;
        break;
      case 'linkedin':
        shareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${encodedUrl}&title=${encodedTitle}`;
        break;
      case 'bluesky':
        shareUrl = `https://bsky.app/intent/compose?text=${encodedTitle}%20${encodedUrl}`;
        break;
      case 'threads':
        shareUrl = `https://www.threads.net/intent/post?text=${encodedTitle}%20${encodedUrl}`;
        break;
      case 'mastodon':
        shareUrl = `https://mastodonshare.com/?text=${encodedTitle}&url=${encodedUrl}`;
        break;
    }

    button.href = shareUrl;
  });

  // Handle copy link button
  const copyButtons = document.querySelectorAll('.copy-link');
  copyButtons.forEach(button => {
    button.addEventListener('click', function() {
      const path = this.dataset.path;
      const absoluteUrl = getAbsoluteUrl(path);

      // Modern clipboard API with fallback
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(absoluteUrl).then(function() {
          showCopiedState(button);
        }).catch(function(err) {
          console.error('Clipboard API failed: ', err);
          fallbackCopyToClipboard(absoluteUrl, button);
        });
      } else {
        fallbackCopyToClipboard(absoluteUrl, button);
      }
    });
  });

  function showCopiedState(button) {
    button.classList.add('copied');
    const span = button.querySelector('span');
    const originalText = span.textContent;
    span.textContent = 'âœ“ Copied!';

    setTimeout(function() {
      button.classList.remove('copied');
      span.textContent = originalText;
    }, 2000);
  }

  function fallbackCopyToClipboard(text, button) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();

    try {
      document.execCommand('copy');
      showCopiedState(button);
    } catch (err) {
      console.error('Fallback copy failed: ', err);
    }

    document.body.removeChild(textArea);
  }
});
</script>
{{ end }}